<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Slide Story</title>
    <link rel="stylesheet" href="./style.css" />
</head>
<body>
    
        <h1>Welcome to Video Story</h1>

        <div class="video-main-list">
          
        </div>

        
</body>
</html>

<script src="./config.js"></script>
<script>

    document.addEventListener('DOMContentLoaded', function(){
        LoadDataConfig();
    })
    
    function LoadDataConfig(){
        const mainContainer = document.querySelector('.video-main-list');
        const storyListContainer = document.createElement('div')
        storyListContainer.className = 'video-storyListContainer'; 
        mainContainer.appendChild(storyListContainer); 

        const storyPopupElement = document.createElement('div');
        storyPopupElement.className = 'story_main_popup';
        mainContainer.appendChild(storyPopupElement)

        function createPopupElement(data){
            function renderProgressBar(blockCount){
                let progressBarHtml = '<div class="story_progressBar">';            
                for (let i = 0; i < blockCount; i++) {
                    progressBarHtml += '<div class="story_progressBarBlock"><div class="story_actualProgress">&nbsp;</div></div>';
                }
                progressBarHtml += '</div>';

                return progressBarHtml;
            }

            function renderVideos(videos){
                return `<source src="${videos[0]}" type="video/mp4">`
            }
            const storyPopupHtml = `<div class="story_popupContainer">
                                        <div class="story_exitButton">
                                            <img src="./iconexit.svg" alt="exit" />
                                        </div> 
                                        <div class="story_imageContainer">
                                            <div class="story_headerHelper"></div> 
                                            <div class="story_storyHeader">
                                                ${renderProgressBar(data.stories.length)}
                                                <div class="story_storyInfo">
                                                    <img class="story_storyInfoImage" src="${data.thumbnail}" alt=""> 
                                                    <p class="story_headerText">${data.title}</p>
                                                </div>
                                            </div> 
                                            <div class="story_storyBodyContainer">
                                                <div class="story_imageContainer">
                                                    <video class="story_image" autoplay playsinline>
                                                        ${renderVideos(data.stories)}
                                                    </video>  
                                                </div>
                                            </div> 
                                            <div class="story_chevronButton story_chevronButtonLeft">
                                                <img src="./iconLeft.svg" alt="iconLeft"/>
                                            </div> 
                                            <div class="story_chevronButton strfy_chevronButtonRight">
                                                <img src="./iconRight.svg" alt="iconRight" />
                                            </div>   
                                        </div>
                                    </div>`;
            
            storyPopupElement.innerHTML = storyPopupHtml;

            const exitButton = document.querySelector('.story_exitButton');

            exitButton.addEventListener('click', function(){
                storyPopupElement.innerHTML = ''
            })

            // Get the video element
            const video = document.querySelector('.story_image');

            // Get the progress bar and actual progress elements
            const progressBar = document.querySelector('.story_progressBarBlock');
            const actualProgress = document.querySelector('.story_actualProgress');

            // Update the progress bar width on timeupdate event of the video
            video.addEventListener('timeupdate', () => {
                // Calculate the progress percentage
                const progress = (video.currentTime / video.duration) * 100;

                // Set the width of the actual progress bar
                actualProgress.style.width = `${progress}%`;
            });
        }
        

        // Iterate through the dataConfig array
        dataConfig.forEach((data, index) => {
            // Create a circle container
            const circleContainer = document.createElement('div');
            circleContainer.className = 'video-circleContainer';

            // Create the circle border
            const circleBorder = document.createElement('div');
            circleBorder.className = 'video-circleBorder';

            // Create the image container
            const imageContainer = document.createElement('div');
            imageContainer.className = 'video-imageContainer';

            // Create the image element
            const image = document.createElement('img');
            image.className = 'video-imageThumbnail';
            image.src = data.thumbnail;
            image.alt = 'thumbnail';

            // Append the image to the image container
            imageContainer.appendChild(image);

            // Append the image container to the circle border
            circleBorder.appendChild(imageContainer);

            // Create the title element
            const title = document.createElement('p');
            title.className = 'video-circleTitle';
            title.textContent = data.title;

            // Append the title and circle border to the circle container
            circleContainer.appendChild(circleBorder);
            circleContainer.appendChild(title);

            // Append the circle container to the main container
            mainContainer.querySelector('.video-storyListContainer').appendChild(circleContainer);

            circleContainer.addEventListener('click', function(){
                createPopupElement(data)
            });
           
        });
    }
    
</script>